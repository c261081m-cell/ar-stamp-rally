<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« | ARã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root{
      --accent:#005ABB;
      --text:#111;
      --muted:#444;
      --bg:#fff;
      --card:#ffffff;
      --shadow:0 12px 32px rgba(0,0,0,.08);
      --radius:16px;
    }
  html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;line-height:1.6;font-size:16px}
    .wrap{max-width:960px;margin:0 auto;padding:clamp(10px,3vw,16px);min-height:100vh;display:flex;flex-direction:column}
    header{padding:4px 0 8px}
    h1{font-size:20px;margin:0;font-weight:900}

    /* ã‚¹ãƒ©ã‚¤ãƒ‰ã‚«ãƒ¼ãƒ‰ */
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:clamp(12px,3vw,18px);
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:60vh;
    }

    /* ç”»åƒé ˜åŸŸï¼ˆã‚¹ãƒãƒ›ç¸¦ã§æœ€å¤§50-55%ï¼‰ */
    .hero{
      /* æ­£æ–¹å½¢ã«å›ºå®šã€‚å¹…ã¯ç”»é¢å¹…ã¨ 55vh ã®å°ã•ã„æ–¹ã«ã—ã¦ç¸¦é•·ç«¯æœ«ã§ã®è¦‹åˆ‡ã‚Œã‚’é˜²ã */
      width: min(100%, 55vh);
      aspect-ratio: 1 / 1;
      border-radius:12px;
      overflow:hidden;
      background:#f3f6fc;
      border:1px solid #e9eef6;
      display:flex;align-items:center;justify-content:center;
      margin-left:auto;margin-right:auto;
    }
    .hero img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    /* ãƒ†ã‚­ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯ï¼ˆä¸‹éƒ¨ï¼‰ */
    .panel{
      margin-top:12px;
      background:transparent;
      border-radius:12px;
      padding:6px 0 80px; /* ä¸‹éƒ¨ãƒœã‚¿ãƒ³é ˜åŸŸã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿ */
    }
    .panel p{margin:.6em 0;font-size:16px}
    .hint{font-size:14px;color:#555;line-height:1.5;margin-top:8px}
    .smallnote{font-size:13px;color:#666;margin-top:8px}
    .pageDots{margin-top:6px;text-align:center;font-size:0}
    .dot{display:inline-block;width:9px;height:9px;margin:0 3px;border-radius:999px;background:#c9d6ee}
    .dot.active{background:var(--accent)}

    /* åˆ©ç”¨è¦ç´„ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ï¼ˆ1ãƒšãƒ¼ã‚¸ç›®ï¼‰ */
    .termsBox{
      height:min(40vh, 320px);
      overflow:auto;
      background:#fff;
      border:1px solid #dfe7f7;
      border-radius:12px;
      padding:12px;
      line-height:1.55;
      font-size:14px;
      color:#222;
    }
    .agreeLine{
      display:flex;align-items:center;gap:10px;margin-top:10px
    }
    .agreeLine small{color:#333}

    /* CTA */
    .ctaRow{display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;margin-top:10px}
    .btn{
      appearance:none;border:0;border-radius:12px;padding:14px 16px;
      font-weight:900;cursor:pointer;background:var(--accent);color:#fff;
      box-shadow:0 10px 28px rgba(0,90,187,.25);
      flex:1;min-width:160px;text-align:center
    }
    .btn[disabled]{opacity:.45;box-shadow:none;cursor:not-allowed}
    .btn-secondary{background:#e9eef6;color:#111;box-shadow:none}
    .btn-ghost{background:transparent;color:var(--accent);box-shadow:none}
    .footerSpace{height:max(8px, env(safe-area-inset-bottom))}

    /* è¨€èªã‚¹ã‚¤ãƒƒãƒï¼ˆå³ä¸Šï¼‰ */
    .lang-switch{position:fixed; right:12px; top:12px; z-index:2147483647}
    .lang-btn{
      appearance:none;border:0;background:#fff;border:1px solid #e3eaf6;border-radius:12px;
      padding:6px; cursor:pointer;
    }
    .lang-btn:focus-visible{outline:3px solid rgba(0,90,187,.35)}
    .lang-icon{width:28px;height:28px;display:block}
    .lang-menu{
      position:absolute; right:0; margin-top:8px; background:#fff; border:1px solid #e3eaf6; border-radius:12px;
      box-shadow:0 10px 28px rgba(0,0,0,.15); display:none; min-width:160px; overflow:hidden
    }
    .lang-menu.is-open{display:block}
    .lang-item{display:block; width:100%; text-align:left; background:#fff; border:0; padding:10px 12px; cursor:pointer; font-weight:800; color:#000}
    .lang-item:hover{background:#f2f6ff}

    /* ãƒ¢ãƒã‚¤ãƒ«é…æ…® */
    @media (max-width:560px){
      .btn{min-width:0}
    }
  </style>
</head>
<body>
  <!-- è¨€èªã‚¹ã‚¤ãƒƒãƒ -->
  <div class="lang-switch" id="langSwitch">
    <button id="langBtn" class="lang-btn" type="button" aria-haspopup="true" aria-expanded="false" aria-controls="langMenu">
      <img class="lang-icon" src="assets/images/ui/lang.png" alt="è¨€èª / Language">
    </button>
    <div id="langMenu" class="lang-menu" role="menu" aria-label="Language">
      <button class="lang-item" data-lang="ja" role="menuitem">æ—¥æœ¬èª</button>
      <button class="lang-item" data-lang="en" role="menuitem">English</button>
    </div>
  </div>

  <div class="wrap">
    <header>
      <h1 data-i18n="tut.title">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</h1>
    </header>

    <main class="card" id="slideRoot" aria-live="polite">
      <!-- ç”»åƒ -->
      <div class="hero" aria-hidden="true">
        <img id="slideImg" src="assets/images/tutorial_photos/tutorial_image01.png" alt="ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”»åƒ">
      </div>

      <!-- ãƒ†ã‚­ã‚¹ãƒˆï¼šä¸‹1/4ç›¸å½“ -->
      <section class="panel">
        <div id="slideText" style="min-height:4lh"></div>

        <!-- walkthrough first page removed -->

        <!-- ãƒšãƒ¼ã‚¸ãƒ‰ãƒƒãƒˆ -->
        <div class="pageDots" aria-hidden="true" id="dots"></div>
      </section>
    </main>

    <div class="footerSpace"></div>

    <!-- ä¸‹éƒ¨å›ºå®šã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæˆ»ã‚‹ / æ¬¡ã¸ï¼‰ -->
    <div class="bottomBar" style="position:fixed;left:0;right:0;bottom:0;padding:12px;backdrop-filter:blur(6px);background:linear-gradient(180deg,rgba(255,255,255,0) 0%, rgba(255,255,255,0.95) 40%);box-shadow:0 -6px 18px rgba(0,0,0,.06);">
      <div style="max-width:960px;margin:0 auto;padding:0 12px;display:flex;gap:10px;">
        <button id="prevBtn" class="btn btn-secondary" type="button" data-i18n="common.prev">æˆ»ã‚‹</button>
        <button id="nextBtn" class="btn" type="button" data-i18n="common.next" style="flex:1">æ¬¡ã¸</button>
        <button id="skipBtn" class="btn-ghost" type="button" data-i18n="common.skip" style="margin-left:6px">skip</button>
      </div>
    </div>
      </section>
    </main>

    <div class="footerSpace"></div>
  </div>

  <script>
    // ç‰ˆæ•°ã‚¯ã‚¨ãƒªï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ï¼‰
    if (!window.withV) {
      window.BUILD_V = window.BUILD_V || '20251005';
      window.withV = (url) => url + (url.includes('?') ? '&' : '?') + 'v=' + window.BUILD_V;
    }

    // ç°¡æ˜“ i18n è¾æ›¸ï¼ˆãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”¨ï¼‰
    (function(){
      const DICT = {
        ja: {
          'tut.title': 'ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«',
          'policy.title': 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼',
          'policy.p1': 'æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯å¤§å­¦ã®å’æ¥­ç ”ç©¶ã®ä¸€ç’°ã¨ã—ã¦å®Ÿæ–½ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆç­‰ã§ã”è¨˜å…¥ã„ãŸã ã„ãŸæƒ…å ±ã¯ã€æœ¬ç ”ç©¶ã«ãŠã‘ã‚‹åˆ†æç›®çš„ã®ã¿ã«ä½¿ç”¨ã—ã€ç ”ç©¶ç›®çš„ä»¥å¤–ã«ã¯ä¸€åˆ‡åˆ©ç”¨ã„ãŸã—ã¾ã›ã‚“ã€‚',
          'policy.p2': 'åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯ã€å€‹äººã‚’ç‰¹å®šã§ããªã„å½¢ã«åŒ¿ååŒ–ã—ãŸã†ãˆã§çµ±è¨ˆçš„ã«å‡¦ç†ãƒ»åˆ†æã‚’è¡Œã„ã¾ã™ã€‚åˆ†æçµæœã‚’å…¬è¡¨ã™ã‚‹éš›ã«ã‚‚ã€å€‹äººã‚’è­˜åˆ¥å‡ºæ¥ã‚‹æƒ…å ±ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚',
          'policy.p3': 'ã¾ãŸã€åˆ©ç”¨è€…ã®åŒæ„ãªãç¬¬ä¸‰è€…ã«å€‹äººæƒ…å ±ã‚’æä¾›ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚',
          'policy.p4': 'æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ç„¡æ–™ã§ã”ä½¿ç”¨ã„ãŸã ã‘ã¾ã™ãŒã€é€šä¿¡ã«ã‹ã‹ã‚‹è²»ç”¨ï¼ˆãƒ¢ãƒã‚¤ãƒ«é€šä¿¡æ–™ãªã©ï¼‰ã¯åˆ©ç”¨è€…ã®ã”è² æ‹…ã¨ãªã‚Šã¾ã™ã€‚',
          'terms.title': 'ã”åˆ©ç”¨ä¸Šã®æ³¨æ„',
          'terms.p1': 'æœ¬ã‚¢ãƒ—ãƒªã¯ã€ARï¼ˆæ‹¡å¼µç¾å®Ÿï¼‰ã‚’ç”¨ã„ãŸä½“é¨“å‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å«ã¿ã€æ­©è¡Œã‚„å±‹å¤–ã§ã®åˆ©ç”¨ã‚’ä¼´ã†å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã”åˆ©ç”¨ã®éš›ã¯ã€å‘¨å›²ã®å®‰å…¨ã«ååˆ†ã”æ³¨æ„ãã ã•ã„ã€‚ã¾ãŸã€ARåˆ©ç”¨ä¸­ã®äº‹æ•…ãƒ»ã‚±ã‚¬ãƒ»æ©Ÿå™¨ã®ç ´æãªã©ã«ã¤ã„ã¦ã€é‹å–¶ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã‹ã­ã¾ã™ã€‚',
          'agree': 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ»ã”åˆ©ç”¨ä¸Šã®æ³¨æ„ã«åŒæ„ã—ã¾ã™ã€‚',
          'common.prev': 'æˆ»ã‚‹',
          'common.next': 'æ¬¡ã¸',
          'common.skip': 'skip',
          // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« 5 ãƒšãƒ¼ã‚¸åˆ†ï¼ˆHTML ã‚’å«ã‚€ï¼‰
          'tut.slide4': `
            <h3>åœ°å›³ã«ã¤ã„ã¦</h3>
            <p>ãƒãƒƒãƒ—ã‚’ä½¿ã£ã¦ã€æ¬¡ã®ã‚¹ãƒãƒƒãƒˆã‚’æ¢ã—ã¾ã—ã‚‡ã†ã€‚<br>
            ãƒ”ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€ã‚¹ãƒãƒ›ã®åœ°å›³ã‚¢ãƒ—ãƒªãŒé–‹ãã€çµŒè·¯ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>
            ç¾åœ°ã«ç€ã„ãŸã‚‰ã€Œã‚¹ãƒãƒƒãƒˆå‘¨è¾ºã«æ¥ã¾ã—ãŸã€ã‹ã‚‰ä½“é¨“ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚</p>
          `,

          'tut.slide2': `
            <h3>ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼ã«ã¤ã„ã¦</h3>
            <p>ãƒãƒƒãƒ—ã®ã‚¹ãƒãƒƒãƒˆã‚’é¸ã³ã€ã€ŒARã‚’é–‹ãã€ã‚’æŠ¼ã—ã¾ã™ã€‚<br>æŒ‡å®šã®å ´æ‰€ã«è¡Œãã¨ã‚«ãƒ¡ãƒ©ãŒèµ·å‹•ã—ã¾ã™ã€‚<br>å‘¨å›²ã‚’æ˜ ã™ã¨ã€VPSãŒä½ç½®ã‚’èªè­˜ã—ã€ŒSaveã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>Saveã‚’æŠ¼ã™ã¨ã‚¹ã‚¿ãƒ³ãƒ—ãŒã¤ãã€è§£èª¬ãŒèª­ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚<br>3ã¤é›†ã‚ã‚‹ã¨ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã§ã™ï¼</p>
            <div class="hint">ğŸ’¡ é€šä¿¡ãŒä¸å®‰å®šãªã¨ãã¯ã€ä¸€åº¦æˆ»ã£ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚</div>
          `,

          'tut.slide3': `
            <h3>ARã«ã¤ã„ã¦</h3>
            <p>ARï¼ˆã‚¨ãƒ¼ã‚¢ãƒ¼ãƒ«ï¼‰ã¯ã€ç¾å®Ÿã®é¢¨æ™¯ã«ä»®æƒ³ã®ã‚‚ã®ã‚’é‡ã­ã¦è¦‹ã‚‹æŠ€è¡“ã§ã™ã€‚<br>ã‚¹ãƒãƒ›ã®ã‚«ãƒ¡ãƒ©ã‚’é€šã—ã¦ã€æ˜”ã®ICUã®å†™çœŸã‚’ä»Šã®æ™¯è‰²ã«é‡ã­ã¦è¡¨ç¤ºã—ã¾ã™ã€‚<br>ã“ã®ã‚¢ãƒ—ãƒªã§ã¯ã€ŒVPSï¼ˆä½ç½®èªè­˜æŠ€è¡“ï¼‰ã€ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚<br>ã‚«ãƒ¡ãƒ©ã‚’å‘¨å›²ã«å‘ã‘ã¦ã‚†ã£ãã‚Šå‹•ã‹ã™ã¨ã€VPSãŒå ´æ‰€ã‚’èªè­˜ã—ã€ã€ŒSaveã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>Saveã‚’æŠ¼ã™ã¨ã‚¹ã‚¿ãƒ³ãƒ—ãŒç™»éŒ²ã•ã‚Œã€è§£èª¬ãŒèª­ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>
            <div class="hint">ğŸ’¡ ã‚«ãƒ¡ãƒ©ã‚’åœ°é¢ã¨å¹³è¡Œã«ã‚†ã£ãã‚Šå·¦å³ã«å‹•ã‹ã™ã¨èªè­˜ã•ã‚Œã‚„ã™ã„ã§ã™ã€‚</div>
            <div class="smallnote">ğŸ“¸ åˆå›ã¯ã€Œã‚«ãƒ¡ãƒ©ã€ã€Œä½ç½®æƒ…å ±ã€ã®è¨±å¯ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚Safariæ¨å¥¨ã€‚ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ–ãƒ©ã‚¦ã‚ºã§ã¯ARãŒå‹•ä½œã—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</div>
          <p>ã‚«ãƒ¡ãƒ©ã¨ä½ç½®æƒ…å ±ã‚’ONã«ã—ã¦ãã ã•ã„ã€‚</p>
          `,

          'tut.slide4': `
            <h3>åœ°å›³ã«ã¤ã„ã¦</h3>
            <p>ãƒãƒƒãƒ—ã‚’ä½¿ã£ã¦ã€æ¬¡ã®ã‚¹ãƒãƒƒãƒˆã‚’æ¢ã—ã¾ã—ã‚‡ã†ã€‚<br>ãƒ”ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã‚¹ãƒãƒƒãƒˆæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>ã•ã‚‰ã«ã‚‚ã†ä¸€åº¦ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€ã‚¹ãƒãƒ›ã®åœ°å›³ã‚¢ãƒ—ãƒªãŒé–‹ãã€çµŒè·¯ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>ç¾åœ°ã«ç€ã„ãŸã‚‰ã€ŒARã‚’é–‹ãã€ã‹ã‚‰ä½“é¨“ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚</p>
            <div class="hint">ğŸ’¡ ãƒ”ãƒ³ãƒæ“ä½œã§æ‹¡å¤§ãƒ»ç¸®å°ã§ãã¾ã™ã€‚ç¾åœ¨åœ°ã‚’ç¢ºèªã—ã¦ã‹ã‚‰å‡ºç™ºã—ã¾ã—ã‚‡ã†ã€‚</div>
          `,

          'tut.slide5': `
            <h3>æœ€å¾Œã«</h3>
            <p>ã“ã‚Œã§ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯å®Œäº†ã§ã™ï¼<br>å®Ÿéš›ã«æ­©ã„ã¦ã€ICUã®æ­´å²ã‚’æ„Ÿã˜ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<br>ã‚¹ã‚¿ãƒ³ãƒ—ã‚’3ã¤é›†ã‚ãŸã‚‰ã€ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ã”å”åŠ›ãã ã•ã„ã€‚<br>ã”å›ç­”ã„ãŸã ã„ãŸæ–¹ã«ã¯ã€ç‰¹åˆ¥ãªã€Œã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€ã‚’ã”ç”¨æ„ã—ã¦ã„ã¾ã™ï¼</p>
            <div class="hint">ğŸ’¡ ãƒšãƒ¼ã‚¸ä¸‹éƒ¨ã®ã€Œã”é€£çµ¡ã¯ã“ã¡ã‚‰ã€ã‹ã‚‰ãŠå•ã„åˆã‚ã›ã‚‚ã§ãã¾ã™ã€‚</div>
          `
        },
        en: {
          'tut.title': 'Tutorial',
          'policy.title': 'Privacy Policy',
          'policy.p1': 'This application is conducted as part of a university graduation research project. Any information you provide (e.g., in the survey) will be used solely for analysis within this research and will not be used for any other purposes.',
          'policy.p2': 'Collected data will be anonymized so individuals cannot be identified, and will be processed and analyzed statistically. Even when publishing results, no personally identifiable information will be included.',
          'policy.p3': 'We will not provide personal information to third parties without the userâ€™s consent.',
          'policy.p4': 'This application is free to use; however, any communication costs (e.g., mobile data charges) are borne by the user.',
          'terms.title': 'Cautions for Use',
          'terms.p1': 'This app includes AR (augmented reality) experiences and may involve walking and outdoor use. Please pay close attention to your surroundings for safety. The organizers cannot be held responsible for any accidents, injuries, or device damage that may occur during AR use.',
          'agree': 'I agree to the Privacy Policy and Cautions for Use.',
          'common.prev': 'Back',
          'common.next': 'Next',
          'common.skip': 'Skip',
          // Minimal English placeholders (can be refined later)
          'tut.slide1': `<h3>Welcome</h3><p>This app uses AR to compare present-day ICU with past ICU. Walk the campus and view historic photos and stories on-site. Collect 3 stamps to complete. Answer the survey to unlock special content.</p><div class="hint">ğŸ’¡ Walk safely and watch your surroundings.</div>`,
          'tut.slide2': `<h3>About the Stamp Rally</h3><p>Select a spot on the map and tap â€œOpen ARâ€. When you reach the spot the camera will start. Point the camera around; VPS will recognize the location and show a â€œSaveâ€ button. Tap Save to get a stamp and read the explanation. Collect 3 to complete.</p><div class="hint">ğŸ’¡ If connection is unstable, go back and retry.</div>`,
          'tut.slide3': `<h3>About AR</h3><p>AR overlays virtual content on the real world. This app uses VPS (visual positioning). Move the camera slowly and parallel to the ground to help recognition. Tap Save to register a stamp and read the explanation.</p><div class="hint">ğŸ’¡ Move the camera slowly left-right, parallel to the ground.</div><div class="smallnote">ğŸ“¸ Camera and location permissions are requested on first use. Safari recommended.</div><p>Please enable camera and location.</p>`,
          'tut.slide4': `
            <h3>About the Map</h3>
            <p>Use the map to find the next spot.<br>
            When you tap a pin, your map app will open and show the route.<br>
            Once you arrive at the spot, start the experience from â€œI have arrived near a spotâ€.</p>
          `,
          'tut.slide5': `<h3>Finish</h3><p>The tutorial is complete. Walk the campus and feel the history. After collecting 3 stamps, please answer the survey to see special content.</p><div class="hint">ğŸ’¡ Contact us via â€œContactâ€ at the bottom of the page.</div>`
        }
      };

      function getLang(){ try { return localStorage.getItem('app_lang') || 'ja'; } catch { return 'ja'; } }
      function setLang(v){ try { localStorage.setItem('app_lang', v); } catch{} }
      function i18n(key){ const lang=getLang(); return (DICT[lang]&&DICT[lang][key]) ?? (DICT.ja[key]||''); }

      window.applyLang = function(lang){
        setLang(lang);
        const dict = DICT[lang] || DICT.ja;
        document.querySelectorAll('[data-i18n]').forEach(el=>{
          const k = el.getAttribute('data-i18n');
          if (dict[k] != null) el.textContent = dict[k];
        });
        document.documentElement.setAttribute('lang', lang==='en'?'en':'ja');
        document.title = (lang==='en') ? 'Tutorial | AR Stamp Rally' : 'ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« | ARã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼';
        // ã‚¹ãƒ©ã‚¤ãƒ‰æœ¬æ–‡ã®å†æç”»
        render();
      };

      // è¨€èªãƒ¡ãƒ‹ãƒ¥ãƒ¼
      (function initLangMenu(){
        const btn  = document.getElementById('langBtn');
        const menu = document.getElementById('langMenu');
        const items= menu?.querySelectorAll('.lang-item');
        const open = (v)=>{ menu.classList.toggle('is-open', v); btn.setAttribute('aria-expanded', v?'true':'false'); };
        btn?.addEventListener('click', (e)=>{ e.stopPropagation(); open(!menu.classList.contains('is-open')); });
        document.addEventListener('click', ()=> open(false));
        items?.forEach(it=>{
          it.addEventListener('click', ()=> window.applyLang(it.dataset.lang || 'ja'));
        });
      })();

      // ã‚¹ãƒ©ã‚¤ãƒ‰å®šç¾©ï¼ˆç”»åƒãƒ»ãƒ†ã‚­ã‚¹ãƒˆï¼‰ â€” æŒ‡å®šã® 5 ãƒšãƒ¼ã‚¸
      const slides = [
        { img: 'assets/images/tutorial_photos/tutorial_image05.png', htmlKey: 'tut.slide1' },
        { img: 'assets/images/tutorial_photos/tutorial_image09.png', htmlKey: 'tut.slide2' },
        { img: 'assets/images/tutorial_photos/tutorial_image02.png', htmlKey: 'tut.slide3' },
        { img: 'assets/images/tutorial_photos/tutorial_image10.jpg',  htmlKey: 'tut.slide4' },
        { img: 'assets/images/tutorial_photos/tutorial_image07.png',  htmlKey: 'tut.slide5' }
      ];

  const imgEl   = document.getElementById('slideImg');
  const textEl  = document.getElementById('slideText');
      const dotsEl  = document.getElementById('dots');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const skipBtn = document.getElementById('skipBtn');

      let idx = 0;

      function renderDots(){
        dotsEl.innerHTML = '';
        for (let i=0;i<slides.length;i++){
          const d = document.createElement('span');
          d.className = 'dot' + (i===idx ? ' active' : '');
          dotsEl.appendChild(d);
        }
      }

      function render(){
        const lang = getLang();
        const s = slides[idx];
        imgEl.src = s.img;
        // ã‚¹ãƒ©ã‚¤ãƒ‰æœ¬æ–‡ã¯ HTML ã‚’å«ã‚€
        textEl.innerHTML = i18n(s.htmlKey) || '';

        // ãƒœã‚¿ãƒ³è¡¨ç¤º
        prevBtn.style.visibility = (idx === 0 ? 'hidden' : 'visible');
        nextBtn.textContent = (idx === slides.length - 1) ? (lang==='en'?'Start':'ã¯ã˜ã‚ã‚‹') : i18n('common.next');
        nextBtn.disabled = false;
        skipBtn.style.display = 'inline-block';

        renderDots();
      }

      async function requestPermissions(){
        try {
          if (navigator.mediaDevices?.getUserMedia) {
            navigator.mediaDevices.getUserMedia({video:true}).then(s=>{ s.getTracks().forEach(t=>t.stop()); }).catch(()=>{});
          }
        } catch(e){}
        try {
          if (navigator.geolocation?.getCurrentPosition) {
            navigator.geolocation.getCurrentPosition(()=>{}, ()=>{}, {enableHighAccuracy:true, timeout:2000});
          }
        } catch(e){}
      }

      function goNext(){
        // Request camera/location permissions when moving from slide 3 into slide 4
        // (i.e. just before transitioning to the page that displays slide 4)
        if (idx === 2){ requestPermissions(); }
        if (idx < slides.length - 1){
          idx++;
          render();
        } else {
          try { localStorage.setItem('tutorial_done','1'); } catch {}
          location.href = withV('map.html');
        }
      }
      function goPrev(){ if (idx > 0){ idx--; render(); } }
      function skipAll(){ try { localStorage.setItem('tutorial_done','1'); } catch {} location.href = withV('map.html'); }

  // agreement checkbox removed; no event listener needed
      prevBtn.addEventListener('click', goPrev);
      nextBtn.addEventListener('click', goNext);
      skipBtn.addEventListener('click', skipAll);

      document.addEventListener('DOMContentLoaded', async ()=>{
        try { await window.ensureAnon?.(); } catch(e){}
        window.applyLang(getLang()); // åˆæœŸé©ç”¨ï¼‹render()
      });
    })();
  </script>
</body>
</html>
