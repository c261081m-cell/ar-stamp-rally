<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>解説 | ARスタンプラリー</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root{
      --accent:#005ABB;
      --text:#111;
      --muted:#444;
      --bg:#fff;
      --card:#ffffff;
      --radius:16px;
      --shadow:0 12px 32px rgba(0,0,0,.08);
    }
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;line-height:1.65}
    .wrap{max-width:960px;margin:0 auto;padding:clamp(10px,3vw,16px)}
    header{padding:6px 0 10px}
    h1{margin:0;font-size:20px;font-weight:900}

    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:clamp(12px,3vw,18px)}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width:720px){ .row{grid-template-columns: 1fr 1fr} }

    .stampRow{display:flex;gap:10px;align-items:center;margin-top:6px}
    .stampImg{width:min(44vw,220px);max-width:220px; border-radius:12px; border:1px solid #e9eef6; background:#f7f9ff}
    .stampNote{font-size:13px;color:#333}

    .photo{
      width:100%; aspect-ratio:4/3; border-radius:12px; overflow:hidden;
      background:#f3f6fc; border:1px solid #e9eef6; display:flex; align-items:center; justify-content:center;
      margin:8px 0 0;
    }
    .photo img{width:100%;height:100%;object-fit:cover;display:block}

    .quizTitle{
      margin:14px 0 6px; font-weight:900; font-size:18px;
      color:#fff; text-shadow:-1px -1px 0 #003b8f, 1px -1px 0 #003b8f, -1px 1px 0 #003b8f, 1px 1px 0 #003b8f;
      display:inline-block; background:#005ABB; padding:6px 10px; border-radius:10px;
    }
    .quizBody{margin:8px 0}
    .choices{margin:6px 0 10px}
    .choices p{margin:.2em 0}
    .btn{
      appearance:none;border:0;border-radius:12px;padding:12px 14px;font-weight:900;cursor:pointer;
      background:var(--accent);color:#fff;box-shadow:0 10px 28px rgba(0,90,187,.25)
    }
    .btn[disabled]{opacity:.45;box-shadow:none;cursor:not-allowed}
    .btn-secondary{background:#e9eef6;color:#111;box-shadow:none}
    .answer{display:none;margin:10px 0 0;font-weight:900;font-size:18px}
    .answer b{font-size:1.1em}

    .explain{margin-top:10px}
    .explain figure{margin:10px 0}
    .explain img{width:100%;height:auto;border-radius:10px;border:1px solid #e9eef6}
    .explain figcaption{font-size:12px;color:#333;margin-top:4px}

    .ctaRow{margin-top:14px; display:flex; gap:10px; flex-wrap:wrap}
    .back{display:inline-block; text-decoration:none}

  .footerSpace{height:max(8px, env(safe-area-inset-bottom))}
  /* スマホ向け: 背景を暗くするためのフラグ */
  body.popup-open .wrap{filter:brightness(.55);transition:filter .18s ease}
  /* スタンプ取得ポップアップ（中央表示） */
  .stamp-popup{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:1250}
  .stamp-popup.show{display:flex}
  .stamp-popup .panel{width:min(86vw,360px);background:transparent;border-radius:18px;padding:0;text-align:center;display:flex;flex-direction:column;align-items:center}
  .stamp-popup .panelInner{background:#fff;border-radius:18px;padding:16px 14px;box-shadow:0 16px 48px rgba(0,0,0,.28);width:100%;display:flex;flex-direction:column;align-items:center}
  .stamp-popup h2{margin:0 0 10px;font-size:18px;font-weight:900;color:#111}
  /* 正方形にして丸角 */
  .stamp-popup .popup-stamp{width:64vw;max-width:260px;height:64vw;max-height:260px;border-radius:18px;border:1px solid #e9eef6;background:#f7f9ff;object-fit:cover}
  .stamp-popup .closeBtn{margin-top:12px;display:inline-block;padding:12px 14px;border-radius:12px;background:#005ABB;color:#fff;font-weight:900;border:0;cursor:pointer}
  /* （動画を使わないため関連スタイルは不要） */
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 id="spotTitle">スポット</h1>
    </header>

    <section class="card">
      <!-- スタンプ取得 -->
      <div class="stampRow">
        <img id="gotStampImage" class="stampImg" src="" alt="取得スタンプ">
        <div class="stampNote" id="stampNote">スタンプをゲットしました！</div>
      </div>

      <!-- メイン写真 -->
      <div class="photo">
        <img id="spotPhoto" src="" alt="スポット写真">
      </div>

      <!-- クイズ -->
      <div id="quizSection">
        <div class="quizTitle" id="quizTitle">クイズ</div>
        <div id="quizBody" class="quizBody"></div>
        <div id="quizChoices" class="choices"></div>
        <button id="showAnswerBtn" class="btn" type="button">答えを見る</button>
        <div id="answerBlock" class="answer"><span id="answerText"></span></div>
      </div>

      <!-- 解説 -->
      <div id="explainBlock" class="explain"></div>

      <!-- 6番はクイズ無しのメッセージ -->
      <div id="specialMessage" style="display:none;margin-top:10px;"></div>

      <!-- 戻る -->
      <div class="ctaRow">
        <a id="backToMap" class="btn back" href="map.html">マップに戻る</a>
      </div>
    </section>

    <div class="footerSpace"></div>
  </div>

  <!-- スタンプ取得ポップアップ -->
  <div id="stampPopup" class="stamp-popup" role="dialog" aria-modal="true" aria-labelledby="stampPopupTitle">
    <div class="panel" id="stampPopupPanel">
      <div class="panelInner">
        <h2 id="stampPopupTitle">スタンプを取得しました</h2>
        <img id="stampPopupImage" class="popup-stamp" src="" alt="取得スタンプ">
        <button id="stampPopupClose" class="closeBtn" type="button">閉じる</button>
      </div>
    </div>
  </div>

  <!-- note: confetti video removed; popup-only UX -->

  <!-- 言語反映 -->
  <script>
    (function(){
      function getLang(){ try { return localStorage.getItem('app_lang') || 'ja'; } catch { return 'ja'; } }
      function applyExplainLang(){
        var lang = getLang();

        // タイトル（ブラウザ）
        document.title = (lang === 'en') ? 'Explanation | AR Stamp Rally' : '解説 | ARスタンプラリー';
        document.documentElement.setAttribute('lang', (lang==='en')?'en':'ja');

        // スタンプ取得メッセージ
        var stampNote = document.getElementById('stampNote');
        if (stampNote){
          stampNote.textContent = (lang === 'en') ? 'You got a stamp!' : 'スタンプをゲットしました！';
        }

        // 「マップに戻る」ボタン
        var back = document.getElementById('backToMap');
        if (back){
            back.textContent = (lang === 'en') ? 'Back to Map' : 'マップに戻る';
        }
        // クエリに returnTo がある場合は戻り先を上書き
        try {
          const params = new URLSearchParams(location.search);
          const ret = params.get('returnTo');
          if (ret && back) {
            back.href = ret;
          }
        } catch(e){}

        // クイズラベル / 答えを見る
        var quizTitle = document.getElementById('quizTitle');
        var showBtn   = document.getElementById('showAnswerBtn');
        if (quizTitle) quizTitle.textContent = (lang === 'en') ? 'Quiz' : 'クイズ';
        if (showBtn)   showBtn.textContent   = (lang === 'en') ? 'Show Answer' : '答えを見る';
      }

      document.addEventListener('DOMContentLoaded', applyExplainLang);
      window.addEventListener('storage', (e)=>{ if (e.key === 'app_lang') applyExplainLang(); });
      window.addEventListener('app_lang_changed', applyExplainLang);
    }());
  </script>

  <script src="js/firebase.js" defer></script>
  <script src="js/explanation.js?v=20251008" defer></script>
</body>
</html>
