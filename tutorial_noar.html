<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>チュートリアル（ARなし） | ARスタンプラリー</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    :root{ --accent:#005ABB; --text:#111; --bg:#fff; --radius:16px }
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;line-height:1.6}
    .wrap{max-width:960px;margin:0 auto;padding:clamp(12px,3vw,18px)}
    .card{background:#fff;border-radius:var(--radius);padding:16px;box-shadow:0 12px 32px rgba(0,0,0,.06)}
    .hero{width:100%;aspect-ratio:1/1;border-radius:12px;overflow:hidden;background:#f3f6fc;border:1px solid #e9eef6;display:flex;align-items:center;justify-content:center}
    .panel{margin-top:12px;background:#f7f9fe;border:1px solid #e3eaf6;border-radius:12px;padding:12px}
    .ctaRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{appearance:none;border:0;border-radius:12px;padding:14px 16px;font-weight:900;cursor:pointer;background:var(--accent);color:#fff;flex:1}
    .btn-secondary{background:#e9eef6;color:#111}
  .footerSpace{height:max(8px, env(safe-area-inset-bottom))}
  .lang-switch{position:fixed; right:12px; top:12px}
  .lang-btn{appearance:none;border:0;background:#fff;border:1px solid #e3eaf6;border-radius:12px;padding:6px; cursor:pointer; box-shadow:0 10px 28px rgba(0,0,0,.15)}
  .lang-btn:focus-visible{outline:3px solid rgba(0,90,187,.35)}
  .lang-icon{width:28px;height:28px;display:block}
  .lang-menu{position:absolute; right:0; margin-top:8px; background:#fff; border:1px solid #e3eaf6; border-radius:12px; box-shadow:0 10px 28px rgba(0,0,0,.15); display:none; min-width:160px; overflow:hidden}
  .lang-menu.is-open{display:block}
  .lang-item{display:block; width:100%; text-align:left; background:#fff; border:0; padding:10px 12px; cursor:pointer; font-weight:800; color:#000}
  .lang-item:hover{background:#f2f6ff}
  </style>
</head>
<body>
  <!-- 言語スイッチ（右上） -->
  <div class="lang-switch" id="langSwitch">
    <button id="langBtn" class="lang-btn" type="button" aria-haspopup="true" aria-expanded="false" aria-controls="langMenu">
      <img class="lang-icon" src="assets/images/ui/lang.png" alt="言語 / Language">
    </button>
    <div id="langMenu" class="lang-menu" role="menu" aria-label="Language">
      <button class="lang-item" data-lang="ja" role="menuitem">日本語</button>
      <button class="lang-item" data-lang="en" role="menuitem">English</button>
    </div>
  </div>

  <div class="wrap">
    <header><h1>はじめに</h1></header>
    <main class="card" aria-live="polite">
      <div class="hero" aria-hidden="true">
        <img id="slideImg" src="assets/images/tutorial_photos/tutorial_image01.png" alt="チュートリアル画像" style="width:100%;height:100%;object-fit:contain;display:block">
      </div>
      <section class="panel">
        <div id="slideText">
          <h2 style="margin-top:0;margin-bottom:8px;font-size:18px;font-weight:800">はじめに</h2>
          <p>このアプリでは、ICUのキャンパスを歩きながら
          スポットを巡る「スタンプラリー」を楽しめます。</p>

          <p>地図からスポットを選んで解説を読んだり、
          スタンプを集めていくことで、
          ICUの歴史をより深く知ることができます。</p>

          <p>3つのスタンプを集めると「コンプリート」です！
          コンプリート後にはアンケートに答えて、
          スペシャルコンテンツを見てみましょう。</p>

          <p>まずは地図から気になる場所を選んでみてください。</p>
        </div>
        <div class="ctaRow" style="justify-content:center;margin-top:16px">
          <button id="beginBtn" class="btn" style="width:64%;background:#005ABB">はじめる</button>
        </div>
      </section>
    </main>
    <div class="footerSpace"></div>
  </div>

  <script>
    if (!window.withV) {
      window.BUILD_V = window.BUILD_V || '20251005';
      window.withV = function(url){ return url + (url.includes('?') ? '&' : '?') + 'v=' + window.BUILD_V; };
    }

    (function(){
      const DICT = {
        ja: {
          'tut.title': 'チュートリアル（ARなし）',
          'noar.lead': 'このモードでは AR を使わず、写真やテキストでスポットの歴史解説をお読みいただけます。',
          'noar.li1': '画面の案内に従って操作してください。',
          'noar.li2': '地図や一覧からスポットを選ぶと、そのスポットの解説が表示されます。',
          'noar.li3': 'スタンプ取得はチュートリアル内の指示に従ってください（3箇所でコンプリート）。',
          'startBtn': 'チュートリアルを始める',
          'skipLink': '解説一覧に進む'
        },
        en: {
          'tut.title': 'Tutorial (No AR)',
          'noar.lead': 'In this mode you can read historical explanations with photos and text without using AR.',
          'noar.li1': 'Follow the on-screen instructions.',
          'noar.li2': 'Select a spot from the map or list to view its explanation.',
          'noar.li3': 'Follow tutorial instructions to collect stamps (complete with 3).',
          'startBtn': 'Start tutorial',
          'skipLink': 'Go to explanation list'
        }
      };

      function getLang(){ try { return localStorage.getItem('app_lang') || 'ja'; } catch { return 'ja'; } }
      function setLang(v){ try { localStorage.setItem('app_lang', v); } catch{} }
      function applyLang(lang){
        const dict = DICT[lang] || DICT.ja;
        const title = document.querySelector('header h1');
        if (title) title.textContent = (lang==='en') ? 'Introduction' : 'はじめに';
        // slideText content: set full paragraphs (Japanese provided). Provide a short English fallback.
        const slide = document.getElementById('slideText');
        if (slide) {
          if (lang === 'en') {
            slide.innerHTML = `
              <h2 style="margin-top:0;margin-bottom:8px;font-size:18px;font-weight:800">Introduction</h2>
              <p>This app lets you enjoy a stamp rally by walking around the ICU campus and visiting spots.</p>
              <p>Select spots on the map to read explanations and collect stamps to learn more about ICU's history.</p>
              <p>Collect 3 stamps to complete the rally! After completion, please take the survey and view the special content.</p>
              <p>Start by choosing a spot on the map.</p>
            `;
          } else {
            slide.innerHTML = `
              <h2 style="margin-top:0;margin-bottom:8px;font-size:18px;font-weight:800">はじめに</h2>
              <p>このアプリでは、ICUのキャンパスを歩きながら
              スポットを巡る「スタンプラリー」を楽しめます。</p>

              <p>地図からスポットを選んで解説を読んだり、
              スタンプを集めていくことで、
              ICUの歴史をより深く知ることができます。</p>

              <p>3つのスタンプを集めると「コンプリート」です！
              コンプリート後にはアンケートに答えて、
              スペシャルコンテンツを見てみましょう。</p>

              <p>まずは地図から気になる場所を選んでみてください。</p>
            `;
          }
        }
        document.title = (lang==='en') ? 'Introduction | AR Stamp Rally' : 'はじめに | ARスタンプラリー';
        document.documentElement.setAttribute('lang', lang==='en'?'en':'ja');
        // update CTA/button texts
        const beginBtn = document.getElementById('beginBtn');
        if (beginBtn) beginBtn.textContent = (dict && dict.startBtn) ? dict.startBtn : (lang==='en' ? 'Start tutorial' : 'はじめる');
      }

      (function initLangMenu(){
        const btn  = document.getElementById('langBtn');
        const menu = document.getElementById('langMenu');
        const items= menu?.querySelectorAll('.lang-item');
        const open = (v)=>{ if (!menu || !btn) return; menu.classList.toggle('is-open', v); btn.setAttribute('aria-expanded', v ? 'true':'false'); };
        btn?.addEventListener('click', (e)=>{ e.stopPropagation(); open(!menu.classList.contains('is-open')); });
        document.addEventListener('click', ()=> open(false));
        items?.forEach(it=>{ it.addEventListener('click', ()=>{ const lang = it.dataset.lang || 'ja'; setLang(lang); applyLang(lang); try { window.dispatchEvent(new Event('app_lang_changed')); } catch(e){} }); });
      })();

      document.addEventListener('DOMContentLoaded', ()=>{ applyLang(getLang()); });
    })();

    document.getElementById('beginBtn')?.addEventListener('click', function(){
      try { localStorage.setItem('tutorial_done','1'); } catch(e){}
      location.href = withV('map_noar.html');
    });
  </script>
</body>
</html>
